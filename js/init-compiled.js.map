{"version":3,"sources":["js/init.js"],"names":[],"mappings":"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","file":"js/init.js","sourcesContent":["Parse.initialize(ArcBase.keys.Parse.a,ArcBase.keys.Parse.b);\nvar table=document.querySelector('#main table'),\n    Book=Parse.Object.extend(\"Book\"),\n    Author=Parse.Object.extend(\"Author\"),\n    authorOverlay=document.querySelector('.author-overlay'),\n    authorModal=document.querySelector('.author-modal'),\n    model;\n\nrivets.adapters['#']={};\nfor (var key in rivets.adapters['.']) {\n  rivets.adapters['#'][key]=rivets.adapters['.'][key];\n}\nrivets.adapters['#'].get=function(obj,keypath) {\n  return obj && obj.get(keypath);\n};\nrivets.adapters['#'].set=function(obj, keypath, value) {\n  return obj && obj.set(keypath, value);\n};\n\nrivets.binders.readonly=function(el, value) {\n  el.readOnly=!!value;\n};\n\nrivets.formatters.opposite=function(value) {\n  return !value;\n};\nrivets.formatters.prepend=function(value, string) {\n  return string ? string+\"\"+value : value;\n};\nrivets.formatters.alphaNumeric=function(v) {\n  return v.replace(/\\W+/g,'-');\n};\n\nfunction authorMapper(author) {\n  var obj=this;\n  return {\n    name: author.get('name'),\n    roles: (obj.get('roleMap') && obj.get('roleMap').find(v => v.id===author.id).roles) || {}\n  };\n}\n\nfunction update(newBook) {\n  var query=new Parse.Query(Book);\n  if (newBook) {query.equalTo('objectId',newBook.id);}\n  query.include('authors').descending('pubdate').find().then(function(results) {\n    results.forEach(v => {\n      var existingBook=model.books.find(book => book.id===v.id);\n      if (v.has('authors')) {v.get('authors').forEach(author => {model.authors.push(author);});}\n      if (existingBook) {\n        existingBook.id=v.id;\n        existingBook.title=v.get('title');\n        existingBook.authors=(v.get('authors') && v.get('authors').map(authorMapper,v)) || [];\n        existingBook.pubdate=v.get('pubdate');\n        existingBook.shortdesc=v.get('shortdesc');\n        existingBook.ISBNs=v.get('ISBNs') && v.get('ISBNs').reduce((obj, current) => {\n          obj[current.type]=current.value;\n          return obj;\n        }, {});\n        existingBook.button='Edit';\n      } else {\n        model.books.push({\n          id: v.id,\n          title: v.get('title'),\n          authors: (v.get('authors') && v.get('authors').map(authorMapper,v)) || [],\n          pubdate: v.get('pubdate'),\n          shortdesc: v.get('shortdesc'),\n          ISBNs: v.get('ISBNs') && v.get('ISBNs').reduce((obj, current) => {\n            obj[current.type]=current.value;\n            return obj;\n          }, {}),\n          /* Methods */\n          button: 'Edit',\n          addAuthor(event,scope) {\n            scope.book.authors.push({\n              name:'',\n              roles: {\n                author: false,\n                translator: false,\n                editor: false,\n                introducer: false\n              }\n            });\n          },\n          isEditing() {\n            return this.button==='Save';\n          },\n        });\n      }\n    });\n    if (newBook) {\n      /* clear inputs */\n      model.inputs={\n        title: '',\n        authors: [{\n          name:'',\n          roles: {\n            author: false,\n            translator: false,\n            editor: false,\n            introducer: false\n          }\n        }],\n        pubdate: '',\n        shortdesc: '',\n        ISBNs: {\n          pbk: '',\n          hbk: '',\n          ebk: ''\n        }\n      };\n    }\n  }).fail(function(err) {\n    console.log(JSON.stringify(err));\n  });\n}\n\nfunction saveToParse(data, bookToEdit) {\n  var query=new Parse.Query(Book),\n      book=bookToEdit ?\n        query.get(bookToEdit.id) :\n        new Book();\n\n  function save(book) {\n    book.save(data, {\n      success: update,\n      error: function(book, error) {\n        console.error(JSON.stringify(error));\n      }\n    });\n  }\n\n  if (bookToEdit) {\n    book.then(save);\n  } else {\n    save(book);\n  }\n}\n\nfunction getParseAuthors(authorsArray) {\n  return new Promise(function(resolve, reject) {\n    var query=new Parse.Query(Author);\n    query.containedIn('name',authorsArray);\n    query.find({\n      success: function(res) {\n        var savedAuthorNames=res.map(v => v.get('name')),\n            promisedAuthors;\n        if (savedAuthorNames.length!==authorsArray.length) {\n          promisedAuthors=authorsArray.map(v => {\n            if (!~savedAuthorNames.indexOf(v)) {\n              let newAuthor=new Author();\n              return newAuthor.save({name: v});\n            } else {\n              return res.find(w => w.get('name')===v);\n            }\n          });\n          Promise.all(promisedAuthors).then(resolve);\n        } else {\n          resolve(res);\n        }\n      }, error: reject\n    });\n  });\n}\n\nmodel={\n  authors: [],\n  books: [],\n  inputs: {\n    title: '',\n    authors: [{\n      name:'',\n      roles: {\n        author: false,\n        translator: false,\n        editor: false,\n        introducer: false\n      }\n    }],\n    pubdate: '',\n    shortdesc: '',\n    ISBNs: {\n      pbk: '',\n      hbk: '',\n      ebk: ''\n    }\n  },\n  selectAll() {\n    if (this.readOnly) {this.select();}\n  },\n  addAuthor() {\n    model.inputs.authors.push({\n      name:'',\n      roles: {\n        author: false,\n        translator: false,\n        editor: false,\n        introducer: false\n      }\n    });\n  },\n\n  submit(event, modelArg, bookToEdit) {\n    var data={},\n        inputModel=bookToEdit||model.inputs,\n        tempInput,tempKey,authors=[];\n\n    if (!inputModel.title.trim()) {\n      alert('Every book needs a title...');\n      return false;\n    } else if (inputModel.authors[inputModel.authors.length-1].name.trim() && !inputModel.authors.every(v => ~v.name.indexOf(','))) {\n      alert('Author names must be Lastname, Firstname');\n      return false;\n    } else {\n      for (var key in inputModel) {\n        tempInput=inputModel[key];\n        tempKey=key;\n\n        if (tempKey==='authors') {\n          tempInput.forEach(v => {\n            v.name.trim() && authors.push(v.name.trim().replace(/\\s{1,}/g,' '));\n          });\n        } else if (tempKey==='ISBNs') {\n          data.ISBNs=Object.keys(tempInput).map(v => {\n            return {type:v,value:tempInput[v].replace(/\\D+/g,'')};\n          });\n        } else {\n          if ('function'!==typeof tempInput && tempKey!=='button') {\n            data[tempKey]=tempInput && tempInput.trim().replace(/\\s{1,}/g,' ');\n          }\n        }\n      }\n      getParseAuthors(authors).then(function(returnedAuthors) {\n        data.authors=returnedAuthors;\n        data.roleMap=[];\n        returnedAuthors.forEach(author => {\n          data.roleMap.push({\n            id: author.id,\n            roles: inputModel.authors.find(v => v.name===author.get('name')).roles\n          });\n        });\n        saveToParse(data, bookToEdit);\n      });\n      return true;\n    }\n  },\n\n  editOrSubmit(event, scope) {\n    if (scope.book.button==='Edit') {\n      scope.book.button='Save';\n    } else {\n      if (model.submit(null, null, scope.book)) {\n        scope.book.button='<img class=\"loading\" src=\"images/loading.gif\">';\n      }\n    }\n  },\n  currentAuthor: undefined,\n  getCurrentAuthor(name) {\n    return this.authors.find(v => v.get('name')===name);\n  },\n  showAuthorModal(event, scope) {\n    if (!scope.book.isEditing()) {\n      model.currentAuthor=model.getCurrentAuthor(scope.author.name);\n      authorOverlay.classList.add('modal-in');\n    }\n  },\n  closeModal(event) {\n    if (this===event.target) {\n      model.isEditingAuthor=false;\n      model.authorButton='Edit';\n      authorOverlay.classList.remove('modal-in');\n    }\n  },\n  isEditingAuthor: false,\n  authorButton: 'Edit',\n  editAuthor(event) {\n    var isEditing=model.authorButton==='Save';\n    model.authorButton=isEditing?'<img class=\"loading\" src=\"images/loading.gif\">':'Save';\n    model.isEditingAuthor=!isEditing;\n    if (isEditing) {\n      model.currentAuthor.save().then(res => {\n        model.authorButton='Edit';\n      }).fail(console.log);\n    }\n  },\n  // alertMe() {\n  //   console.log(arguments);\n  // },\n  menu() {\n    // var loadFile=function(url,callback){\n    //     JSZipUtils.getBinaryContent(url,callback);\n    // };\n    // loadFile(\"examples/tagExample.docx\", function(err,content) {\n    //     if (err) {throw err;}\n    //     doc=new Docxgen(content);\n    //     doc.setData({\n    //       \"first_name\":\"Hipp\",\n    //       \"last_name\":\"Edgar\",\n    //       \"phone\":\"0652455478\",\n    //       \"description\":\"New Website\"\n    //     }); //set the templateVariables\n    //     doc.render(); //apply them (replace all occurences of {first_name} by Hipp, ...)\n    //     out=doc.getZip().generate({type:\"blob\"}); //Output the document using Data-URI\n    //     saveAs(out,\"output.docx\");\n    // });\n  }\n};\n\nrivets.bind(document.body, model);\nupdate();\n"]}