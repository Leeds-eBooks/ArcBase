{"version":3,"sources":["js/init.js"],"names":[],"mappings":"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","file":"js/init.js","sourcesContent":["Parse.initialize(ArcBase.keys.Parse.a,ArcBase.keys.Parse.b);\nvar table=document.querySelector('#main table'),\n    Book=Parse.Object.extend(\"Book\"),\n    Author=Parse.Object.extend(\"Author\"),\n    authorOverlay=document.querySelector('.author-overlay'),\n    authorModal=document.querySelector('.author-modal'),\n    model;\n\nrivets.binders.readonly=function(el, value) {\n  el.readOnly=!!value;\n};\nrivets.formatters.opposite=function(value) {\n  return !value;\n};\n\nfunction update(newBook) {\n  var query=new Parse.Query(Book);\n  if (newBook) {query.equalTo('objectId',newBook.id);}\n  query.include('authors').descending('pubdate').find().then(function(results) {\n    results.forEach(v => {\n      var existingBook=model.books.find(book => book.id===v.id);\n      v.get('authors').forEach(author => {model.authors.push(author);});\n      if (existingBook) {\n        existingBook.id=v.id;\n        existingBook.title=v.get('title');\n        existingBook.authors=v.get('authors') && v.get('authors').map(v => {return {value:v.get('name')};});\n        existingBook.pubdate=v.get('pubdate');\n        existingBook.shortdesc=v.get('shortdesc');\n        existingBook.ISBNs=v.get('ISBNs') && v.get('ISBNs').reduce((obj, current) => {\n          obj[current.type]=current.value;\n          return obj;\n        }, {});\n        existingBook.button='Edit';\n      } else {\n        model.books.push({\n          id: v.id,\n          title: v.get('title'),\n          authors: v.get('authors') && v.get('authors').map(v => {return {value:v.get('name')};}),\n          pubdate: v.get('pubdate'),\n          shortdesc: v.get('shortdesc'),\n          ISBNs: v.get('ISBNs') && v.get('ISBNs').reduce((obj, current) => {\n            obj[current.type]=current.value;\n            return obj;\n          }, {}),\n          /* Methods */\n          button: 'Edit',\n          addAuthor(event,scope) {\n            scope.book.authors.push({value:''});\n          },\n          isEditing() {\n            return this.button==='Submit';\n          },\n        });\n      }\n    });\n    if (newBook) {\n      /* clear inputs */\n      model.inputs={\n        title: '',\n        authors: [{value:''}],\n        pubdate: '',\n        shortdesc: '',\n        ISBNs: {\n          pbk: '',\n          hbk: '',\n          ebk: ''\n        }\n      };\n    }\n  }).fail(function(err) {\n    console.log(JSON.stringify(err));\n  });\n}\n\nfunction saveToParse(data, authorRelations, bookToEdit) {\n  var query=new Parse.Query(Book),\n      book=bookToEdit ?\n        query.get(bookToEdit.id) :\n        new Book();\n\n  function save(book) {\n    book.save(data, {\n      success: update,\n      error: function(book, error) {\n        console.error(JSON.stringify(error));\n      }\n    });\n  }\n\n  if (bookToEdit) {\n    book.then(save);\n  } else {\n    save(book);\n  }\n}\n\nfunction getParseAuthors(authorsArray) {\n  return new Promise(function(resolve, reject) {\n    var query=new Parse.Query(Author);\n    query.containedIn('name',authorsArray);\n    query.find({\n      success: function(res) {\n        var savedAuthorNames=res.map(v => v.get('name')),\n            promisedAuthors;\n        if (savedAuthorNames.length!==authorsArray.length) {\n          promisedAuthors=authorsArray.map(v => {\n            if (!~savedAuthorNames.indexOf(v)) {\n              let newAuthor=new Author();\n              return newAuthor.save({name: v});\n            } else {\n              return res.find(w => w.get('name')===v);\n            }\n          });\n          Promise.all(promisedAuthors).then(resolve);\n        } else {\n          resolve(res);\n        }\n      }, error: reject\n    });\n  });\n}\n\nmodel={\n  authors: [],\n  books: [],\n  inputs: {\n    title: '',\n    authors: [{value:''}],\n    pubdate: '',\n    shortdesc: '',\n    ISBNs: {\n      pbk: '',\n      hbk: '',\n      ebk: ''\n    }\n  },\n  selectAll() {\n    if (this.readOnly) {this.select();}\n  },\n  addAuthor() {\n    model.inputs.authors.push({value:''});\n  },\n  currentAuthor: {\n    name: '',\n    biog: ''\n  },\n  getCurrentAuthor(name) {\n    return this.authors.find(v => v.get('name')===name);\n  },\n  showAuthorModal(event, scope) {\n    var author=model.getCurrentAuthor(scope.author.value);\n    model.currentAuthor.name=author.get('name');\n    authorOverlay.classList.add('modal-in');\n  },\n  closeModal(event) {\n    if (this===event.target) {\n      authorOverlay.classList.remove('modal-in');\n    }\n  },\n  submit(event, modelArg, bookToEdit) {\n    var data={},\n        inputModel=bookToEdit||model.inputs,\n        tempInput,tempKey,authors=[];\n\n    if (!inputModel.title.trim()) {\n      alert('Every book needs a title...');\n      return false;\n    } else if (inputModel.authors[inputModel.authors.length-1].value.trim() && !inputModel.authors.every(v => ~v.value.indexOf(','))) {\n      alert('Author names must be Lastname, Firstname');\n      return false;\n    } else {\n      for (var key in inputModel) {\n        tempInput=inputModel[key];\n        tempKey=key;\n\n        if (tempKey==='authors') {\n          tempInput.forEach(v => {v.value.trim() && authors.push(v.value.trim().replace(/\\s{1,}/g,' '));});\n        } else if (tempKey==='ISBNs') {\n          data.ISBNs=Object.keys(tempInput).map(v => {\n            return {type:v,value:tempInput[v].replace(/\\D+/g,'')};\n          });\n        } else {\n          if ('function'!==typeof tempInput && tempKey!=='button') {\n            data[tempKey]=tempInput && tempInput.trim().replace(/\\s{1,}/g,' ');\n          }\n        }\n      }\n      getParseAuthors(authors).then(function(returnedAuthors) {\n        data.authors=returnedAuthors;\n        saveToParse(data, returnedAuthors, bookToEdit);\n      });\n      return true;\n    }\n  },\n  editOrSubmit(event, scope) {\n    if (scope.book.button==='Edit') {\n      scope.book.button='Submit';\n    } else {\n      if (model.submit(null, null, scope.book)) {\n        scope.book.button='<img class=\"loading\" src=\"images/loading.gif\">';\n      }\n    }\n  },\n};\n\nrivets.bind(document.body, model);\nupdate();\n"]}